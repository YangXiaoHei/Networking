#### P25. 我们曾经说过，应用程序可能选择 UDP 作为运输协议，因为 UDP 提供了（比 TCP）更好的应用层控制，以决定在报文段中发送什么数据和发送时机。
#### a. 应用程序为什么对在报文段中发送什么数据有更多的控制。
#### b. 应用程序为什么对何时发送报文段有更多的控制。

> a.
> 
> TCP 发送数据时，先将数据放入发送缓冲区，然后再从缓冲区中拿出一块一块数据，附上运输层首部字段成为 TCP 报文段，再进行发送。从缓冲区中拿出的数据可能会多也可能会少，这取决于 MSS、流量控制以及拥塞控制、以及应用层往套接字中注入数据的速率等几个方面。而 UDP 不一样，无论应用交给 UDP 多长的数据，UDP 都将它压缩在一个报文段内发送(⚠️⚠️⚠️ UDP 的首部字段中描述长度信息的域仅为两个字节，即最大 UDP 包为 65535 字节)。因此应用程序对在报文段中发送什么数据有更多的控制。
> 
> b.
> 
> 由于 TCP 的流量控制和拥塞控制机制，在数据放入 TCP 发送缓存到 TCP 将报文段交付给网络层之间可能会有很长的延时，而 UDP 没有流量控制和拥塞控制，因此对何时发送有更多的控制。

#### P26. 考虑从主机 A 向主机 B 传输 L 字节的大文件，假设 MSS 为 536 字节。
#### a. 为了使得 TCP 序号不至于用完，L 的最大值时多少？前面讲过 TCP 的序号字段为 4 字节。
#### b. 对于你在（a）中得到的 L，求出传输此文件要用多长时间？假定运输层、网络层和数据链路层首部总共 66 字节，并加在每个报文段上，然后经 155 Mbps 链路发送得到的分组。忽略流量控制和拥塞控制，使主机 A 能够一个接一个和连续不断地发送这些报文段。

> a.
> 
> TCP 4 字节的序号范围是 `2^32 - 1`，所以为了使传输一个大文件时不会导致序号用光，该大文件的长度最多为 `2^32 - 1 ~ 4 G`。
> 
> b.
> 
> 每个 TCP 报文段会增加一些首部字段长度，因此，先计算有多少个 TCP 报文段
> 
> `(2^32 - 1) / 536 = 8012999`
> 
> 因此，由于首部字段增加的总长度为 `8012999 x 66 = 528857934`
> 
> 因此总共发送的字节长度为 `2^32 - 1 + 528857934 = 4823825229`
> 
> 所以传输时延为 `T_trans = 4823825229 x 8 / (155 x 10^6) = 31 x 8 s = 248 s`

#### P27. 主机 A 和 B 经一条 TCP 连接通信，并且主机 B 已经收到了来自 A 的最长为 126 字节的所有字节。假定主机 A 随后向主机 B 发送两个紧接着的报文段。第一个和第二个报文段分别包含了 80 字节和 40 字节的数据。在第一个报文段中，序号是 127，源端口号是 302，目的端口号是 80。无论何时主机 B 接收到来自主机 A 的报文段，他都会发送确认。
#### a. 在主机 A 发往主机 B 的第二个报文段中，序号、源端口号和目的端口号是什么？
#### b. 如果第一个报文段在第二个报文段之前到达，在第一个到达报文段的确认中，确认号、源端口号和目的端口号各是什么？
#### c. 如果第二个报文段在第一个报文段之前到达，在第一个到达报文段的确认中，确认号是什么？
#### d. 假定由 A 发送的两个报文段按序到达 B。第一个确认丢失了而第二个确认在第一个超时间隔之后到达。画出时序图，显示这些报文段和发送的所有其他报文段和确认。（假设没有其他分组丢失。）对于图上每个报文段，标出序号和数据的字节数量；对于你增加的每个应答，标出确认号。

> a.
> 
> 在主机 A 发往主机 B 的第二个报文段中，序号是 207、源端口号是 302、目的端口号是 80。
> 
> b.
> 
> 如果第一个报文段在第二个报文段之前到达，在第一个到达报文段的确认中，确认号是 207、源端口号是 80、目的端口号是 302。
> 
> c.
> 
> 如果第二个报文段在第一个报文段之前到达，在第一个到达报文段的确认中，确认号是 127、源端口号是 80、目的端口是 302。
> 
> d.
> 
> ![](https://github.com/YangXiaoHei/Networking/blob/master/03%20运输层/images/p27.png)

#### P28. 主机 A 和 B 直接经一条 100 Mbps 链路连接。在这两台主机之间有一条 TCP 连接。主机 A 经这条连接向主机 B 发送一个大文件。主机 A 能够向它的 TCP 套接字以高达 120 Mbps 的速率发送应用数据，而主机 B 能够以最大 50 Mbsp 的速率从它的 TCP 接收缓存中读出数据。描述 TCP 流量控制的影响。

> 因为链路是 100 Mbps，所以 A 的发送速率最多是 100 Mbps，主机 B 以大约 40 Mbps 的速率充满接收缓存，当主机 B 接收缓存满了之后，主机 B 通知主机 A 停止发送数据，通过传送接收窗口置为 0 的 TCP 报文段。接下来主机 A 停止发送数据，而是不断得发送一个字节的报文段去探询主机 B 是否接收缓存中有空闲空间去接受数据。若某个确认报文段中接收窗口不是 0，那么主机 A 重新开始发送数据。长期平均的话，主机 A 的发送速率不会大于 60 Mbps。
